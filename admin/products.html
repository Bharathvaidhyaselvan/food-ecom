<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - iFood Admin</title>
</head>
<body style="margin:0; font-family: 'Inter', sans-serif;">
    <!-- Admin Section -->
    <section style="padding:60px 0; background-color:#f8f9fa;">
        <div style="width:100%; max-width:1200px; margin:0 auto; padding:0 20px;">
            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 30px;">
                <!-- Admin Sidebar -->
                <div style="background-color: #0a2463; color:#fff; border-radius:15px; padding:30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="text-align:center; margin-bottom:30px; padding-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1);">
                        <div style="width:80px; height:80px; border-radius:50%; margin:0 auto 15px; overflow:hidden; border:3px solid #ffd100;">
                            <img src="/placeholder.svg?height=80&width=80" alt="Admin Avatar" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <h3 style="font-size:1.2rem; margin-bottom:5px;">Admin User</h3>
                        <p style="font-size:0.9rem; color:rgba(255,255,255,0.7);">Administrator</p>
                    </div>
                    <div>
                        <ul style="padding:0; list-style:none;">
                            <li style="margin-bottom:10px;"><a href="dashboard.html" style="display: block; padding:10px 15px; border-radius:8px; color:#fff; text-decoration:none;">üìä Dashboard</a></li>
                            <li style="margin-bottom:10px;"><a href="orders.html" style="display: block; padding:10px 15px; border-radius:8px; color:#fff; text-decoration:none;">üì¶ Orders</a></li>
                            <li style="margin-bottom:10px;"><a href="products.html" class="active" style="display: block; padding:10px 15px; border-radius:8px; color:#fff; text-decoration:none; background-color: rgba(255,255,255,0.1);">üçî Products</a></li>
                            <li style="margin-bottom:10px;"><a href="categories.html" style="display: block; padding:10px 15px; border-radius:8px; color:#fff; text-decoration:none;">üìÅ Categories</a></li>
                            <li><a href="../index.html" style="display: block; padding:10px 15px; border-radius:8px; color:#fff; text-decoration:none;">üè† Back to Website</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Admin Content -->
                <div style="background-color:#fff; border-radius:15px; padding:30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:30px; padding-bottom:20px; border-bottom:1px solid #eee;">
                        <h2 style="font-size:1.8rem; color:#0a2463; margin:0;">Manage Products</h2>
                        <div>
                            <button id="add-product-btn" style="background-color:#ffd100; color:#0a2463; font-weight:600; padding:10px 25px; border:none; border-radius:30px; cursor:pointer;">Add New Product</button>
                        </div>
                    </div>
                    <!-- Product Table -->
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background-color:#f8f9fa; color:#0a2463; font-weight:600;">
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">ID</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Image</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Title</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Description</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Price</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Rating</th>
                                <th style="padding:15px; text-align:left; border-bottom:1px solid #eee;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                            <!-- Products will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Form Modal with inline CSS -->
    <div class="modal" id="product-modal" style="display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items: center; justify-content: center;">
        <div class="modal-content" style="background:#fff; padding:20px; border-radius:10px; width:90%; max-width:600px; position: relative;">
            <span class="close-modal" id="close-product-modal" style="cursor: pointer; position: absolute; top:10px; right:20px; font-size:24px;">&times;</span>
            <div class="modal-header" style="margin-bottom:20px;">
                <h2 id="product-form-title" style="margin:0;">Add New Product</h2>
            </div>
            <form id="product-form" style="display:block;">
                <input type="hidden" id="product-id">
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-title" style="display:block; margin-bottom:8px; font-weight:500;">Title</label>
                    <input type="text" id="product-title" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-description" style="display:block; margin-bottom:8px; font-weight:500;">Description</label>
                    <textarea id="product-description" rows="3" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px;"></textarea>
                </div>
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-price" style="display:block; margin-bottom:8px; font-weight:500;">Price ($)</label>
                    <input type="number" id="product-price" step="0.01" min="0" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-rating" style="display:block; margin-bottom:8px; font-weight:500;">Rating (1-5)</label>
                    <input type="number" id="product-rating" min="1" max="5" step="0.1" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-image" style="display:block; margin-bottom:8px; font-weight:500;">Image URL</label>
                    <input type="text" id="product-image" value="/placeholder.svg?height=400&width=600" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px;">
                </div>
                <div class="form-group" style="margin-bottom:20px;">
                    <label for="product-category" style="display:block; margin-bottom:8px; font-weight:500;">Category</label>
                    <select id="product-category" required style="width:100%; padding:12px 15px; border:1px solid #ddd; border-radius:8px; appearance: none;">
                        <option value="1">Main Course</option>
                        <option value="2">Appetizers</option>
                        <option value="3">Desserts</option>
                        <option value="4">Beverages</option>
                        <option value="5">Specials</option>
                    </select>
                </div>
                <button type="submit" style="background-color:#ffd100; color:#0a2463; font-weight:600; padding:10px 25px; border:none; border-radius:30px; cursor:pointer;">Save Product</button>
            </form>
        </div>
    </div>

    <script>
        // Load products from JSON
        async function loadProducts() {
            try {
                const response = await fetch('../products.json');
                return await response.json();
            } catch (error) {
                console.error('Error loading products:', error);
                return [];
            }
        }
        
        // Save products to localStorage
        function saveProducts(products) {
            localStorage.setItem('admin_products', JSON.stringify(products));
        }
        
        // Get products (from localStorage if available, otherwise from JSON)
        async function getProducts() {
            const storedProducts = localStorage.getItem('admin_products');
            if (storedProducts) {
                return JSON.parse(storedProducts);
            } else {
                const products = await loadProducts();
                saveProducts(products);
                return products;
            }
        }
        
        // Display products in the table
        async function displayProducts() {
            const products = await getProducts();
            const tableBody = document.getElementById('products-table');
            tableBody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding:15px; border-bottom:1px solid #eee;">${product.id}</td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">
                        <img src="${product.image}" alt="${product.title}" style="width:50px; height:50px; object-fit:cover; border-radius:5px;">
                    </td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">${product.title}</td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">${product.description.substring(0, 50)}${product.description.length > 50 ? '...' : ''}</td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">$${product.price.toFixed(2)}</td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">${product.rating}</td>
                    <td style="padding:15px; border-bottom:1px solid #eee;">
                        <button class="action-btn edit-product-btn" data-id="${product.id}" style="background:transparent; border:none; cursor:pointer; font-size:1rem; color:#0a2463;">‚úèÔ∏è</button>
                        <button class="action-btn delete-product-btn" data-id="${product.id}" style="background:transparent; border:none; cursor:pointer; font-size:1rem; color:#0a2463;">üóëÔ∏è</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Event Listeners for edit and delete buttons
            document.querySelectorAll('.edit-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }
        
        // Open modal to add new product
        function addProduct() {
            document.getElementById('product-form-title').textContent = 'Add New Product';
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-modal').style.display = 'flex';
        }
        
        // Edit product
        async function editProduct(productId) {
            const products = await getProducts();
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('product-form-title').textContent = 'Edit Product';
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-title').value = product.title;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-rating').value = product.rating;
            document.getElementById('product-image').value = product.image;
            document.getElementById('product-category').value = product.category || 1;
            document.getElementById('product-modal').style.display = 'flex';
        }
        
        // Delete product
        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                const products = await getProducts();
                const updatedProducts = products.filter(product => product.id !== productId);
                saveProducts(updatedProducts);
                displayProducts();
                alert('Product deleted successfully!');
            }
        }
        
        // Handle form submission
        document.getElementById('product-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const productId = document.getElementById('product-id').value;
            const products = await getProducts();
            
            const productData = {
                title: document.getElementById('product-title').value,
                description: document.getElementById('product-description').value,
                price: parseFloat(document.getElementById('product-price').value),
                rating: parseFloat(document.getElementById('product-rating').value),
                image: document.getElementById('product-image').value,
                category: parseInt(document.getElementById('product-category').value)
            };
            
            if (productId) {
                const index = products.findIndex(p => p.id === parseInt(productId));
                if (index !== -1) {
                    products[index] = { ...products[index], ...productData };
                }
            } else {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                products.push({ id: newId, ...productData });
            }
            
            saveProducts(products);
            displayProducts();
            document.getElementById('product-modal').style.display = 'none';
            alert(productId ? 'Product updated successfully!' : 'Product added successfully!');
        });
        
        // Add product button
        document.getElementById('add-product-btn').addEventListener('click', addProduct);
        
        // Close modal on close button click
        document.getElementById('close-product-modal').addEventListener('click', function() {
            document.getElementById('product-modal').style.display = 'none';
        });
        
        // Close modal when clicking outside the modal-content
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('product-modal');
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // Initialize products on load
        displayProducts();
    </script>
</body>
</html>