<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - iFood Admin</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <section class="admin-section">
        <div class="container">
            <div class="admin-container">
                <div class="admin-sidebar">
                    <div class="admin-profile">
                        <div class="admin-avatar">
                            <img src="/placeholder.svg?height=80&width=80" alt="Admin Avatar">
                        </div>
                        <h3 class="admin-name">Admin User</h3>
                        <p class="admin-role">Administrator</p>
                    </div>
                    <div class="admin-menu">
                        <ul>
                            <li><a href="dashboard.html"><span class="admin-menu-icon">üìä</span> Dashboard</a></li>
                            <li><a href="orders.html"><span class="admin-menu-icon">üì¶</span> Orders</a></li>
                            <li><a href="products.html" class="active"><span class="admin-menu-icon">üçî</span> Products</a></li>
                            <li><a href="categories.html"><span class="admin-menu-icon">üìÅ</span> Categories</a></li>
                            <li><a href="../index.html"><span class="admin-menu-icon">üè†</span> Back to Website</a></li>
                        </ul>
                    </div>
                </div>
                <div class="admin-content">
                    <div class="admin-header">
                        <h2 class="admin-title">Manage Products</h2>
                        <div class="admin-actions">
                            <button id="add-product-btn" class="btn">Add New Product</button>
                        </div>
                    </div>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Rating</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                            <!-- Products will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Form Modal -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-product-modal">&times;</span>
            <div class="modal-header">
                <h2 id="product-form-title">Add New Product</h2>
            </div>
            <form id="product-form" class="admin-form">
                <input type="hidden" id="product-id">
                <div class="form-group">
                    <label for="product-title">Title</label>
                    <input type="text" id="product-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="product-description">Description</label>
                    <textarea id="product-description" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="product-price">Price ($)</label>
                    <input type="number" id="product-price" class="form-control" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="product-rating">Rating (1-5)</label>
                    <input type="number" id="product-rating" class="form-control" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="product-image">Image URL</label>
                    <input type="text" id="product-image" class="form-control" value="/placeholder.svg?height=400&width=600" required>
                </div>
                <div class="form-group">
                    <label for="product-category">Category</label>
                    <select id="product-category" class="form-control" required>
                        <option value="1">Main Course</option>
                        <option value="2">Appetizers</option>
                        <option value="3">Desserts</option>
                        <option value="4">Beverages</option>
                        <option value="5">Specials</option>
                    </select>
                </div>
                <button type="submit" class="btn">Save Product</button>
            </form>
        </div>
    </div>

    <script>
        // Load products from JSON
        async function loadProducts() {
            try {
                const response = await fetch('../products.json');
                return await response.json();
            } catch (error) {
                console.error('Error loading products:', error);
                return [];
            }
        }
        
        // Save products to localStorage (since we can't modify the JSON file directly in a static site)
        function saveProducts(products) {
            localStorage.setItem('admin_products', JSON.stringify(products));
        }
        
        // Get products (from localStorage if available, otherwise from JSON)
        async function getProducts() {
            const storedProducts = localStorage.getItem('admin_products');
            if (storedProducts) {
                return JSON.parse(storedProducts);
            } else {
                const products = await loadProducts();
                saveProducts(products);
                return products;
            }
        }
        
        // Display products
        async function displayProducts() {
            const products = await getProducts();
            const tableBody = document.getElementById('products-table');
            tableBody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td><img src="${product.image}" alt="${product.title}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;"></td>
                    <td>${product.title}</td>
                    <td>${product.description.substring(0, 50)}${product.description.length > 50 ? '...' : ''}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.rating}</td>
                    <td>
                        <button class="action-btn edit-product-btn" data-id="${product.id}">‚úèÔ∏è</button>
                        <button class="action-btn delete-product-btn" data-id="${product.id}">üóëÔ∏è</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }
        
        // Add new product
        function addProduct() {
            // Reset form
            document.getElementById('product-form-title').textContent = 'Add New Product';
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            
            // Show modal
            document.getElementById('product-modal').style.display = 'flex';
        }
        
        // Edit product
        async function editProduct(productId) {
            const products = await getProducts();
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Set form title
            document.getElementById('product-form-title').textContent = 'Edit Product';
            
            // Fill form with product data
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-title').value = product.title;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-rating').value = product.rating;
            document.getElementById('product-image').value = product.image;
            document.getElementById('product-category').value = product.category || 1;
            
            // Show modal
            document.getElementById('product-modal').style.display = 'flex';
        }
        
        // Delete product
        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                const products = await getProducts();
                const updatedProducts = products.filter(product => product.id !== productId);
                
                saveProducts(updatedProducts);
                displayProducts();
                
                alert('Product deleted successfully!');
            }
        }
        
        // Handle form submission
        document.getElementById('product-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const productId = document.getElementById('product-id').value;
            const products = await getProducts();
            
            const productData = {
                title: document.getElementById('product-title').value,
                description: document.getElementById('product-description').value,
                price: parseFloat(document.getElementById('product-price').value),
                rating: parseFloat(document.getElementById('product-rating').value),
                image: document.getElementById('product-image').value,
                category: parseInt(document.getElementById('product-category').value)
            };
            
            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id === parseInt(productId));
                if (index !== -1) {
                    products[index] = { ...products[index], ...productData };
                }
            } else {
                // Add new product
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                products.push({
                    id: newId,
                    ...productData
                });
            }
            
            saveProducts(products);
            displayProducts();
            
            // Close modal
            document.getElementById('product-modal').style.display = 'none';
            
            alert(productId ? 'Product updated successfully!' : 'Product added successfully!');
        });
        
        // Add product button
        document.getElementById('add-product-btn').addEventListener('click', addProduct);
        
        // Close modal
        document.getElementById('close-product-modal').addEventListener('click', function() {
            document.getElementById('product-modal').style.display = 'none';
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('product-modal');
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // Initialize products page
        displayProducts();
    </script>
</body>
</html>